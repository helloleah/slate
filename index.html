
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen-37358005.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-bccf8c07.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-1b266558.js"></script>
  </head>

  <body class="index" data-languages="[&quot;json&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-da571c67.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="json">json</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#main" class="toc-h1 toc-link" data-title="Main">Main</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-requests" class="toc-h2 toc-link" data-title="Get Requests">Get Requests</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#get-all-icu-bedcounts" class="toc-h3 toc-link" data-title="Get all ICU bedcounts">Get all ICU bedcounts</a>
                          </li>
                          <li>
                            <a href="#get-all-icus" class="toc-h3 toc-link" data-title="Get all ICUs">Get all ICUs</a>
                          </li>
                          <li>
                            <a href="#get-all-regions" class="toc-h3 toc-link" data-title="Get all regions">Get all regions</a>
                          </li>
                          <li>
                            <a href="#get-visible-bedcounts-for-current-user" class="toc-h3 toc-link" data-title="Get visible bedcounts for current user">Get visible bedcounts for current user</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#update-requests" class="toc-h2 toc-link" data-title="Update Requests">Update Requests</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#sync-bedcount-csvs-to-the-database" class="toc-h3 toc-link" data-title="Sync bedcount CSVs to the database">Sync bedcount CSVs to the database</a>
                          </li>
                          <li>
                            <a href="#update-bedcounts-from-the-update-form-page" class="toc-h3 toc-link" data-title="Update bedcounts from the update form page">Update bedcounts from the update form page</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#settings-info" class="toc-h2 toc-link" data-title="Settings/Info">Settings/Info</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#consent-to-icubam-terms" class="toc-h3 toc-link" data-title="Consent to ICUBAM terms">Consent to ICUBAM terms</a>
                          </li>
                          <li>
                            <a href="#get-version-information" class="toc-h3 toc-link" data-title="Get version information">Get version information</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#page-rendering" class="toc-h2 toc-link" data-title="Page Rendering">Page Rendering</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#render-operational-dashboard-page" class="toc-h3 toc-link" data-title="Render operational dashboard page">Render operational dashboard page</a>
                          </li>
                          <li>
                            <a href="#render-the-home-page" class="toc-h3 toc-link" data-title="Render the home page">Render the home page</a>
                          </li>
                          <li>
                            <a href="#render-the-home-page-with-an-api-key" class="toc-h3 toc-link" data-title="Render the home page with an API key">Render the home page with an API key</a>
                          </li>
                          <li>
                            <a href="#render-the-update-form-page" class="toc-h3 toc-link" data-title="Render the update form page">Render the update form page</a>
                          </li>
                          <li>
                            <a href="#render-unauthorized-error-page" class="toc-h3 toc-link" data-title="Render unauthorized error page">Render unauthorized error page</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#admin" class="toc-h1 toc-link" data-title="Admin">Admin</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#user-actions" class="toc-h2 toc-link" data-title="User Actions">User Actions</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#add-or-update-a-user-from-the-user-s-page" class="toc-h3 toc-link" data-title="Add or update a user from the user(s) page">Add or update a user from the user(s) page</a>
                          </li>
                          <li>
                            <a href="#log-the-user-out" class="toc-h3 toc-link" data-title="Log the user out">Log the user out</a>
                          </li>
                          <li>
                            <a href="#login-the-user-from-the-login-page" class="toc-h3 toc-link" data-title="Login the user from the login page">Login the user from the login page</a>
                          </li>
                          <li>
                            <a href="#reset-consent-status-for-a-user" class="toc-h3 toc-link" data-title="Reset consent status for a user">Reset consent status for a user</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#database-actions" class="toc-h2 toc-link" data-title="Database actions">Database actions</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#add-or-update-a-region-from-the-region-s-page" class="toc-h3 toc-link" data-title="Add or update a region from the region(s) page">Add or update a region from the region(s) page</a>
                          </li>
                          <li>
                            <a href="#sync-data-from-csv" class="toc-h3 toc-link" data-title="Sync data from CSV">Sync data from CSV</a>
                          </li>
                          <li>
                            <a href="#update-a-token-from-the-access-token-s-page" class="toc-h3 toc-link" data-title="Update a token from the access token(s) page">Update a token from the access token(s) page</a>
                          </li>
                          <li>
                            <a href="#update-an-icu-from-the-icu-s-page" class="toc-h3 toc-link" data-title="Update an ICU from the ICU(s) page">Update an ICU from the ICU(s) page</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#page-rendering" class="toc-h2 toc-link" data-title="Page Rendering">Page Rendering</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#render-home-page" class="toc-h3 toc-link" data-title="Render home page">Render home page</a>
                          </li>
                          <li>
                            <a href="#render-login-page" class="toc-h3 toc-link" data-title="Render login page">Render login page</a>
                          </li>
                          <li>
                            <a href="#render-page-for-a-region" class="toc-h3 toc-link" data-title="Render page for a region">Render page for a region</a>
                          </li>
                          <li>
                            <a href="#render-page-for-a-token" class="toc-h3 toc-link" data-title="Render page for a token">Render page for a token</a>
                          </li>
                          <li>
                            <a href="#render-page-for-a-user" class="toc-h3 toc-link" data-title="Render page for a user">Render page for a user</a>
                          </li>
                          <li>
                            <a href="#render-page-for-an-icu" class="toc-h3 toc-link" data-title="Render page for an ICU">Render page for an ICU</a>
                          </li>
                          <li>
                            <a href="#render-page-for-all-bedcounts-for-icus-that-user-is-an-admin-for" class="toc-h3 toc-link" data-title="Render page for all bedcounts for ICUs that user is an admin for">Render page for all bedcounts for ICUs that user is an admin for</a>
                          </li>
                          <li>
                            <a href="#render-page-for-all-icus" class="toc-h3 toc-link" data-title="Render page for all ICUs">Render page for all ICUs</a>
                          </li>
                          <li>
                            <a href="#render-page-for-all-regions" class="toc-h3 toc-link" data-title="Render page for all regions">Render page for all regions</a>
                          </li>
                          <li>
                            <a href="#render-page-for-all-scheduled-messages-for-current-user" class="toc-h3 toc-link" data-title="Render page for all scheduled messages for current user">Render page for all scheduled messages for current user</a>
                          </li>
                          <li>
                            <a href="#render-page-for-all-tokens" class="toc-h3 toc-link" data-title="Render page for all tokens">Render page for all tokens</a>
                          </li>
                          <li>
                            <a href="#render-page-for-current-user" class="toc-h3 toc-link" data-title="Render page for current user">Render page for current user</a>
                          </li>
                          <li>
                            <a href="#render-page-that-lists-all-users" class="toc-h3 toc-link" data-title="Render page that lists all users">Render page that lists all users</a>
                          </li>
                          <li>
                            <a href="#render-the-map-page" class="toc-h3 toc-link" data-title="Render the map page">Render the map page</a>
                          </li>
                          <li>
                            <a href="#render-the-operational-dashboard-page" class="toc-h3 toc-link" data-title="Render the operational dashboard page">Render the operational dashboard page</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#messaging" class="toc-h1 toc-link" data-title="Messaging">Messaging</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#activate-or-deactivate-reception-of-messages-for-a-user" class="toc-h2 toc-link" data-title="Activate or deactivate reception of messages for a user">Activate or deactivate reception of messages for a user</a>
                  </li>
                  <li>
                    <a href="#retrieve-information-about-scheduled-messages-for-a-user" class="toc-h2 toc-link" data-title="Retrieve information about scheduled messages for a user">Retrieve information about scheduled messages for a user</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://github.com/icubam/icubam'>ICUBAM on GitHub</a></li>
            <li><a href='https://github.com/slatedocs/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Welcome to the ICUBAM API! ICU Bed Activity Monitor (ICUBAM) is an open-source project whose aim is to gather real-time data on intensive care unit (ICU) bed availability. This project was started in March 2020 to help managed the COVID-19 pandemic in French hospitals, but could be expanded to other healthcare systems using our API. You can use our API to access the ICUBAM database, which has data on ICU bed availability, as well as data on the ICUs we manage and the geographical regions where they reside. Our webpage rendering functions for the main server and admin server are also documented here under the respective &quot;Rendering&quot; sections.</p>

<p>ICUBAM has three different servers: the main application server, the admin portal (or &quot;back office&quot;) server, and the messaging server. The APIs documented here are categorized by the server they are hosted on.</p>

<p>You can view code examples in the dark area to the right.</p>

<p>More information about ICUBAM and its source code can be found on <a href='https://github.com/icubam/icubam'>Github</a>.</p>
<h1 id='main'>Main</h1><h2 id='get-requests'>Get Requests</h2><h3 id='get-all-icu-bedcounts'>Get all ICU bedcounts</h3>
<p><strong><code>GET /db/all_bedcounts</code></strong></p>

<p>Returns all bedcount data. User must have GET access to the ICUBAM stats.</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>format</code></td>
<td>string</td>
<td>File format of output. Can be &#39;csv&#39; or &#39;hdf&#39; for CSV and HDF files. Otherwise, the output will be written in HTML.</td>
</tr>
<tr>
<td><code>max_ts</code></td>
<td>integer</td>
<td>Restricts the time of the bedcounts returned to this date. Time is in seconds since epoch.</td>
</tr>
<tr>
<td><code>should_preprocess</code></td>
<td>string</td>
<td>Whether preprocessing should be applied to the data. The raw data of ICUBAM contains inputs errors and this preprocessing will attempt to fix them. It should be used cautiously because it alters the data in ways that are useful for analysis purposes but not necessarily reflect the exact/real bed count values. Whenever a query argument named &#39;preprocess&#39; is present, we enable this preprocessing (it can be &#39;preprocess=<anything>&#39; or simply &#39;preprocess&#39;).</td>
</tr>
</tbody></table>
<h3 id='get-all-icus'>Get all ICUs</h3>
<p><strong><code>GET /db/get_icus</code></strong></p>

<p>Returns a list of all ICUs. User must have GET access to the ICUBAM stats.</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>format</code></td>
<td>string</td>
<td>File format of output. Can be &#39;csv&#39; or &#39;hdf&#39; for CSV and HDF files. Otherwise, the output will be written in HTML.</td>
</tr>
</tbody></table>
<h3 id='get-all-regions'>Get all regions</h3>
<p><strong><code>GET /db/get_regions</code></strong></p>

<p>Returns a list of all regions. User must have GET access to the ICUBAM stats.</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>format</code></td>
<td>string</td>
<td>File format of output. Can be &#39;csv&#39; or &#39;hdf&#39; for CSV and HDF files. Otherwise, the output will be written in HTML.</td>
</tr>
</tbody></table>
<h3 id='get-visible-bedcounts-for-current-user'>Get visible bedcounts for current user</h3>
<p><strong><code>GET /db/bedcounts</code></strong></p>

<p>Returns the latest bed counts of ICS that are visible to the user.
Admin users can view all ICUs. For other users, only ICUs that are in the
same regions as the ICUs that they are assigned to will be visible.</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>format</code></td>
<td>string</td>
<td>File format of output. Can be &#39;csv&#39; or &#39;hdf&#39; for CSV and HDF files. Otherwise, the output will be written in HTML.</td>
</tr>
<tr>
<td><code>max_ts</code></td>
<td>integer</td>
<td>Restricts the time of the bedcounts returned to this date. Time is in seconds since epoch.</td>
</tr>
</tbody></table>
<h2 id='update-requests'>Update Requests</h2><h3 id='sync-bedcount-csvs-to-the-database'>Sync bedcount CSVs to the database</h3>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  files:
    {
      file: {
        body: // file body
      }
    }
  ]
}
</code></pre>
<p>Request arguments: TODO: not sure about this, code is confusing</p>

<p><strong><code>POST /db/bedcounts</code></strong></p>

<p>Sync bedcount CSVs from IdF RoR uplink. User must have POST access to the ICUBAM stats.</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>format</code></td>
<td>string</td>
<td>File format of input. Only &#39;ror_idf&#39; is supported at this time.</td>
</tr>
</tbody></table>
<h3 id='update-bedcounts-from-the-update-form-page'>Update bedcounts from the update form page</h3>
<p><strong><code>POST /update_counts</code></strong></p>

<p>Register new bedcounts coming from the form by reading the form and saving to the DB. The form data is encoded in the request body. TODO: not sure if this is exactly right</p>
<h2 id='settings-info'>Settings/Info</h2><h3 id='consent-to-icubam-terms'>Consent to ICUBAM terms</h3>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  agree: "0" // can be "0" for disagree or "1" for agree
}
</code></pre>
<p><strong><code>POST /consent</code></strong></p>

<p>Depending on which button the user has clicked, we decide to set the
consent field of the user to True or False.
If False, the user has no access to ICUBAM and it is considered as
inactive. Otherwise we won&#39;t ask again and acces is granted.</p>
<h3 id='get-version-information'>Get version information</h3>
<p><strong><code>GET /version</code></strong></p>

<p>Retrieves ICUBAM version, git hash of most recent commit, and last modified date of bedcounts data</p>
<h2 id='page-rendering'>Page Rendering</h2><h3 id='render-operational-dashboard-page'>Render operational dashboard page</h3>
<p><strong><code>GET /dashboard</code></strong></p>

<p>Serves a page with a table gathering current bedcount data with some extra information. Must have an API key with GET database access.</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>region</code></td>
<td>integer</td>
<td>The id of the region to limit the data to.</td>
</tr>
</tbody></table>
<h3 id='render-the-home-page'>Render the home page</h3>
<p><strong><code>GET /</code></strong></p>

<p>Renders index.html, which seems to include the map, TODO needs more investigation</p>
<h3 id='render-the-home-page-with-an-api-key'>Render the home page with an API key</h3>
<p><strong><code>GET /map</code></strong></p>

<p>Same as previous section for /, but accessed with an API key. Must have an API key with MAP access.</p>
<h3 id='render-the-update-form-page'>Render the update form page</h3>
<p><strong><code>GET /update</code></strong></p>

<p>Renders update_form.html. User will be prompted to consent if they haven&#39;t already</p>

<p>TODO: the code says &quot;the user object and the icu object encoded in the token&quot;??</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>The user&#39;s access token TODO: this should be the same for everything that has a APIKeyProtectedHandler, they&#39;re just written in the base class</td>
</tr>
</tbody></table>
<h3 id='render-unauthorized-error-page'>Render unauthorized error page</h3>
<p><strong><code>GET /error</code></strong></p>

<p>Renders error.html for 401 error (unauthorized)</p>

<p>Query/request arguments: none</p>
<h1 id='admin'>Admin</h1><h2 id='user-actions'>User Actions</h2><h3 id='add-or-update-a-user-from-the-user-s-page'>Add or update a user from the user(s) page</h3>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  "password": "12345",
  "user_id": 56789,
  "name": "Dave Davidson",
  "telephone": "8888888888",
  "email": "",
  "description": "",
  "password_hash": "", // Strong hash of the password. Used for admin and manager users
  "access_salt": "", // Used for regular users for passwordless access.
  "is_active": "1", // 1 for true, 0 for false,
  "is_admin": "0", // 1 for true, 0 for false
  "locale": "", // Locale of the user for translations
  "message_type": "email", // One of {email, sms},
  "consent": true, // Consent to use ICUBAM,
  "create_date": "2020-04-27 22-56-45",
  "last_modified": "2020-04-27 22-56-45",
  "icus" = [], // ICUs that the user is assigned to
  "managed_icus" = [], // ICUs that the user manages
}
</code></pre>
<p><code>POST /user</code></p>

<p>Create a new user or update attributes of an existing user from the user form.</p>
<h3 id='log-the-user-out'>Log the user out</h3>
<p><code>GET /logout</code></p>

<p>Logs the current user out.</p>

<p>Query/request arguments: none</p>
<h3 id='login-the-user-from-the-login-page'>Login the user from the login page</h3>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  "email": "example@example.com",
  "password": "12345",
  "next": "/" // Can also be specified as a query param
}
</code></pre>
<p><code>POST /login</code></p>

<p>Login the user from the login page form.</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>next</code></td>
<td>string</td>
<td>The URL to redirect if the user is already logged in. Can also be specified in the request body.</td>
</tr>
</tbody></table>
<h3 id='reset-consent-status-for-a-user'>Reset consent status for a user</h3>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  "12345" // the user id
}
</code></pre>
<p><code>POST /reset_consent</code></p>

<p>Reset consent status for a user.</p>
<h2 id='database-actions'>Database actions</h2><h3 id='add-or-update-a-region-from-the-region-s-page'>Add or update a region from the region(s) page</h3>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  "region_id": 12345,
  "name": "ABCD",
  "create_date": "2020-04-27 22-56-45",
  "last_modified": "2020-04-27 22-56-45",
  "icus": [] // ICUs in the region
}
</code></pre>
<p><code>POST /region</code></p>

<p>Add a new region, or update the name of a region.</p>
<h3 id='sync-data-from-csv'>Sync data from CSV</h3>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  "data": "", // CSV content
  "objtype": "ICUs" // One of: {"ICUs", "Bed Counts", "Scheduled Messages", "Regions", "Users", "Access Tokens"}
}
</code></pre>
<p><code>POST /upload</code></p>

<p>Sync users, ICUs, or bedcounts from a CSV to the datastore.</p>
<h3 id='update-a-token-from-the-access-token-s-page'>Update a token from the access token(s) page</h3>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  "external_client_id": 12345,
  "name": "ABCD",
  "email": "example@example.com",
  "telephone": "1234567890",
  "access_key_hash": "ABCD", // Strong hash of the access key. It should be unique.
  "access_key": "ABCD", // Be aware this will be removed at some point in the future.
  "expiration_date": "2021-04-27 22-56-45", // If set, denotes the date that the access key expires.
  "is_active": "1", // 1 for true, 0 for false.
  "access_type": "1", // 1 for map access, 2 for database retrieve access, 3 for database upload access, 4 for all access
  "create_date": "2020-04-27 22-56-45",
  "last_modified": "2020-04-27 22-56-45",
  "regions": [] // Regions that an external client can access.
}
</code></pre>
<p><code>POST /token</code></p>

<p>Update access information for an external client:</p>

<ul>
<li>whether or not they are active</li>
<li>access type</li>
<li>access expiration date</li>
</ul>
<h3 id='update-an-icu-from-the-icu-s-page'>Update an ICU from the ICU(s) page</h3>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  "icu_id": 56789,
  "region_id": 56789, // Region id that the ICU belongs to
  "region": "ABC", // Name of the region that the ICU belongs to
  "name": "ABC",
  "legal_id": "ABC",
  "dept": "ABC",
  "city": "ABC",
  "country": "ABC",
  "lat": 11.752505,
  "long": 158.695720,
  "telephone": "9999999999",
  "is_active": "1", // 1 for true, 0 for false
  "create_date": "2020-04-27 22-56-45",
  "last_modified": "2020-04-27 22-56-45",
  "bed_counts" = [], // History of bed counts for the ICU
  "users" = [], // Users assigned to the ICU
  "managers" = [] // Users that can manage the ICU
}
</code></pre>
<p><code>POST /icu</code></p>

<p>From the ICU page form:</p>

<ul>
<li>Update whether an ICU is active or not
AND/OR</li>
<li>Update an ICU&#39;s region id</li>
</ul>
<h2 id='page-rendering'>Page Rendering</h2><h3 id='render-home-page'>Render home page</h3>
<p><code>GET /</code></p>

<p>Renders home.html, which shows a tree view of ICUs that the user manages.</p>
<h3 id='render-login-page'>Render login page</h3>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  "next": "/", // Can also be specified as a query param
  "error": False // Can also be specified as a query param
}
</code></pre>
<p><code>GET /login</code></p>

<p>Renders the login.html page. If the user is already logged in, redirects to the home page.</p>
<h3 id='render-page-for-a-region'>Render page for a region</h3>
<p><code>GET /region</code></p>

<p>Renders region.html given an id for that region.</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>The id of the region to display.</td>
</tr>
</tbody></table>
<h3 id='render-page-for-a-token'>Render page for a token</h3>
<p><code>GET /token</code></p>

<p>A token is an access token for an external client that can access ICUBAM data. Given a userid, this  page lists an external client, whether or not they are active, their access type, and their access expiration date.</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>The id of the token to display.</td>
</tr>
</tbody></table>
<h3 id='render-page-for-a-user'>Render page for a user</h3>
<p><code>GET /user</code></p>

<p>Render the form for a user given their id. User data includes:</p>

<ul>
<li>whether or not they are an admin</li>
<li>whether or not they are active</li>
<li>create date</li>
<li>ICUs they have access to</li>
<li>ICUs they manage</li>
</ul>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>The id of the user to display.</td>
</tr>
</tbody></table>
<h3 id='render-page-for-an-icu'>Render page for an ICU</h3>
<p><code>GET /icu</code></p>

<p>Renders icu.html given the id for that ICU.</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>The id of the ICU to display.</td>
</tr>
</tbody></table>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>next</code></td>
<td>string</td>
<td>The URL to redirect if the user is already logged in. Can also be specified in the request body.</td>
</tr>
<tr>
<td><code>error</code></td>
<td>boolean</td>
<td>Whether or not an error message should be displayed. Can also be specified in the request body.</td>
</tr>
</tbody></table>
<h3 id='render-page-for-all-bedcounts-for-icus-that-user-is-an-admin-for'>Render page for all bedcounts for ICUs that user is an admin for</h3>
<p><code>GET /bedcounts</code></p>

<p>Renders a page with all bedcounts for ICUs that user is an admin for.</p>
<h3 id='render-page-for-all-icus'>Render page for all ICUs</h3>
<p><code>GET /list_icus</code></p>

<p>If the user is an admin, lists all ICUs. Otherwise, lists ICUs managed by the user.</p>
<h3 id='render-page-for-all-regions'>Render page for all regions</h3>
<p><code>GET /list_regions</code></p>

<p>Renders a page with all regions listed.</p>
<h3 id='render-page-for-all-scheduled-messages-for-current-user'>Render page for all scheduled messages for current user</h3>
<p><code>GET /list_messages</code></p>

<p>Lists scheduled messages for the current user.</p>
<h3 id='render-page-for-all-tokens'>Render page for all tokens</h3>
<p><code>GET /list_tokens</code></p>

<p>Lists all external clients, whether or not they are active, their access type, and their access expiration date.</p>
<h3 id='render-page-for-current-user'>Render page for current user</h3>
<p><code>GET /profile</code></p>

<p>Renders /user form for current user.</p>
<h3 id='render-page-that-lists-all-users'>Render page that lists all users</h3>
<p><code>GET /list_users</code></p>

<p>Render a page that lists all users, including forms to update them. If the current user is an admin, lists all users. Otherwise, lists users that the current user manages.</p>
<h3 id='render-the-map-page'>Render the map page</h3>
<p><code>GET /map</code></p>

<p>Renders map.html.</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>level</code></td>
<td>integer</td>
<td>The level to display data at. Must be one of {&quot;country&quot;, &quot;region&quot;, &quot;dept&quot;, &quot;city&quot;, &quot;icu&quot;}. Default is &quot;dept.&quot;</td>
</tr>
</tbody></table>
<h3 id='render-the-operational-dashboard-page'>Render the operational dashboard page</h3>
<p><code>GET /operational-dashboard</code></p>

<p>Serves a page with a table gathering current bedcount data with some extra information (operational-dashboard.html).</p>

<p><strong>Querystring parameters</strong></p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>region</code></td>
<td>integer</td>
<td>The id of the region to limit the data to.</td>
</tr>
</tbody></table>
<h1 id='messaging'>Messaging</h1><h2 id='activate-or-deactivate-reception-of-messages-for-a-user'>Activate or deactivate reception of messages for a user</h2>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  user_id: 212039,
  icu_ids: [123, 434] // List of ICU ids,
  on: True // True to turn on, False to turn off,
  delay: 60 // Number of seconds to delay message sending
}
</code></pre>
<p><code>POST /onoff</code></p>

<p>Used to activate of deactivate the reception of messages.
When a new user is created, the message server should be
informed so that they start receving messages. The user can then opt-out of messages.
User must belong to listed ICUs to toggle message reception.</p>
<h2 id='retrieve-information-about-scheduled-messages-for-a-user'>Retrieve information about scheduled messages for a user</h2>
<blockquote>
<p>Request body</p>
</blockquote>
<pre class="highlight plaintext"><code>{
  user_id: 12345
}
</code></pre>
<p><code>POST /schedule</code></p>

<p>Returns information about all scheduled messages for a user, including:
- icu_id
- user_id
- user_name
- icu_name
- phone
- attempts
- first_sent
- when
- url</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="json">json</a>
          </div>
      </div>
    </div>
  </body>
</html>
